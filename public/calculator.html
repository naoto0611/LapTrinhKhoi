<!DOCTYPE html>
<html>
<head>
    <title>Blockly Calculator</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://unpkg.com/blockly"></script>
</head>
<body>
    <h1>Blockly Calculator</h1>
    <div id="blocklyDiv" style="height: 480px; width: 100%;"></div>
    <xml id="toolbox" style="display: none">
        <!-- Category "Khối nhập" (Blocks for Input) -->
        <category name="Input">
            <!-- Bổ sung label "Nhập số tự nhiên" -->
            <block type="math_number">
                <field name="NUM" text="Nhập số tự nhiên"></field>
            </block>
        </category>

        <!-- Category "Khối Phép tính" (Blocks for Arithmetic Operations) -->
        <category name="Operations">
            <!-- Khối Cộng (Addition) -->
            <block type="math_addition">
                <field name="OP">ADD</field>
                <value name="A">
                    <!-- <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow> -->
                </value>
                <value name="B">
                    <!-- <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow> -->
                </value>
            </block>

            <!-- Khối Trừ (Subtraction) -->
            <block type="math_subtraction">
                <field name="OP">MINUS</field>
                <value name="A">
                    <!-- <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow> -->
                </value>
                <value name="B">
                    <!-- <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow> -->
                </value>
            </block>

            <!-- Khối Nhân (Multiplication) -->
            <block type="math_multiplication">
                <field name="OP">MULTIPLY</field>
                <value name="A">
                    <!-- <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow> -->
                </value>
                <value name="B">
                    <!-- <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow> -->
                </value>
            </block>

            <!-- Khối Chia (Division) -->
            <block type="math_division">
                <field name="OP">DIVIDE</field>
                <value name="A">
                    <!-- <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow> -->
                </value>
                <value name="B">
                    <!-- <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow> -->
                </value>
            </block>
        </category>
        <category name="Variable" custom="VARIABLE">

        </category>
    </xml>
    <button onclick="runCode()">Run</button>
    <p id="result">Result:</p>

    <script>
        var workspace = Blockly.inject('blocklyDiv', { toolbox: document.getElementById('toolbox') });

        Blockly.Blocks['math_addition'] = {
            init: function() {
                this.jsonInit({
                    "message0": "Tổng của %1 + %2",
                    "args0": [
                        {
                            "type": "input_value",
                            "name": "A",
                            "check": "Number"
                        },
                        {
                            "type": "input_value",
                            "name": "B",
                            "check": "Number"
                        }
                    ],
                    "output": "Number",
                    "inputsInline": true,
                    "colour":  "#FF6600",
                    "tooltip": "Phép cộng hai số",
                    "helpUrl": ""
                });
            }
        };

        Blockly.Blocks['math_subtraction'] = {
            init: function() {
                this.jsonInit({
                    "message0": " Hiệu của %1 - %2",
                    "args0": [
                        {
                            "type": "input_value",
                            "name": "A",
                            "check": "Number"
                        },
                        {
                            "type": "input_value",
                            "name": "B",
                            "check": "Number"
                        }
                    ],
                    "output": "Number",
                    "inputsInline": true,
                    "colour": "#0066CC" ,
                    "tooltip": "Phép trừ hai số",
                    "helpUrl": ""
                });
            }
        };

        Blockly.Blocks['math_multiplication'] = {
            init: function() {
                this.jsonInit({
                    "message0": "Tích của %1 x %2",
                    "args0": [
                        {
                            "type": "input_value",
                            "name": "A",
                            "check": "Number"
                        },
                        {
                            "type": "input_value",
                            "name": "B",
                            "check": "Number"
                        }
                    ],
                    "output": "Number",
                    "inputsInline": true,
                    "colour": "#FF33CC",
                    "tooltip": "Phép nhân hai số",
                    "helpUrl": ""
                });
            }
        };

        Blockly.Blocks['math_division'] = {
            init: function() {
                this.jsonInit({
                    "message0": "Phân của %1 : %2",
                    "args0": [
                        {
                            "type": "input_value",
                            "name": "A",
                            "check": "Number"
                        },
                        {
                            "type": "input_value",
                            "name": "B",
                            "check": "Number"
                        }
                    ],
                    "output": "Number",
                    "inputsInline": true,
                    "colour": "#00CC66",
                    "tooltip": "Phép chia hai số",
                    "helpUrl": ""
                });
            }
        };

        Blockly.JavaScript['math_addition'] = function(block) {
            var value_a = Blockly.JavaScript.valueToCode(block, 'A', Blockly.JavaScript.ORDER_ATOMIC);
            var value_b = Blockly.JavaScript.valueToCode(block, 'B', Blockly.JavaScript.ORDER_ATOMIC);
            var code = value_a + ' + ' + value_b;
            return [code, Blockly.JavaScript.ORDER_ADDITION];
        };

        Blockly.JavaScript['math_subtraction'] = function(block) {
            var value_a = Blockly.JavaScript.valueToCode(block, 'A', Blockly.JavaScript.ORDER_ATOMIC);
            var value_b = Blockly.JavaScript.valueToCode(block, 'B', Blockly.JavaScript.ORDER_ATOMIC);
            var code = value_a + ' - ' + value_b;
            return [code, Blockly.JavaScript.ORDER_SUBTRACTION];
        };

        Blockly.JavaScript['math_multiplication'] = function(block) {
            var value_a = Blockly.JavaScript.valueToCode(block, 'A', Blockly.JavaScript.ORDER_ATOMIC);
            var value_b = Blockly.JavaScript.valueToCode(block, 'B', Blockly.JavaScript.ORDER_ATOMIC);
            var code = value_a + ' * ' + value_b;
            return [code, Blockly.JavaScript.ORDER_MULTIPLICATION];
        };

        Blockly.JavaScript['math_division'] = function(block) {
            var value_a = Blockly.JavaScript.valueToCode(block, 'A', Blockly.JavaScript.ORDER_ATOMIC);
            var value_b = Blockly.JavaScript.valueToCode(block, 'B', Blockly.JavaScript.ORDER_ATOMIC);
            var code = value_a + ' / ' + value_b;
            return [code, Blockly.JavaScript.ORDER_DIVISION];
        };

        function runCode() {
            Blockly.JavaScript.addReservedWords('code');
            var code = Blockly.JavaScript.workspaceToCode(workspace);
            var result = eval(code);
            document.getElementById('result').textContent = 'Result: ' + result;
        }
    </script>
</body>
</html>
